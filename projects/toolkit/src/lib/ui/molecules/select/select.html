<div class="flex flex-col group" [style]="themeStyles()">
  
  @if (label() && labelAppearance() === 'outside') {
    <label 
      [class]="'mb-0.5 text-sm font-medium ' + labelClass()"
      [style.color]="focused() || hasError() ? 'var(--ui-color-text)' : ''">
      {{ label() }}
      @if (required() && showAsteriskRequired()) {<span class="text-red-600">*</span>}
    </label>
  }

  <div class="relative w-full">
    <div 
      [class]="'relative cursor-pointer flex flex-row items-center px-3 bg-white border '+classContainer()"
      [class.h-6]="size() === 'xs'"
      [class.h-8]="size() === 'sm'"
      [class.h-10]="size() === 'md'"
      [class.h-12]="size() === 'lg'"
      [class.h-14]="size() === 'xl'"
      [class.rounded-full]="borderAppearance() === 'full'"
      [class.rounded-lg]="borderAppearance() === 'rounded'"
      [class.ring-1]="focused()"
      [style.border-color]="focused() || hasError() ? 'var(--ui-color-main)' : 'var(--color-gray-300)'"
      [style.--tw-ring-color]="focused() ? 'var(--ui-color-main)' : ''"
      [class.opacity-50]="disabled()"
      [class.pointer-events-none]="disabled()"
      (click)="toggle()"
    >
      @if (label() && labelAppearance() === 'border') {
        <label 
          [class]="'absolute left-3 px-1 -top-2.5 text-xs font-medium bg-white pointer-events-none z-10' + labelClass()"
          [style.color]="focused() || hasError() ? 'var(--ui-color-text)' : 'var(--color-gray-500)'">
          {{ label() }}
          @if (required() && showAsteriskRequired()) {<span class="text-red-600">*</span>}
        </label>
      }

      <div class="flex flex-1 items-center gap-2 py-2 overflow-hidden">
        @if (selectedItem()) {
          @if (selectedItemTmpl()) {
            <ng-container [ngTemplateOutlet]="selectedItemTmpl()!.template" [ngTemplateOutletContext]="{ $implicit: selectedItem() }"></ng-container>
          } @else {
            <span class="truncate text-sm text-gray-900">{{ getLabel(selectedItem()) }}</span>
          }
        } @else {
          <span class="text-sm text-gray-400">{{ placeholder() }}</span>
        }
      </div>

      @if (showClear() && selectedValue()) {
        <button (click)="clearInput($event)" type="button" class="pl-1 flex items-center cursor-pointer text-gray-400 hover:text-gray-600 shrink-0">
          <span class="material-icons text-lg">close</span>
        </button>
      }

       @if (loading()) {
        <div class="pl-1 shrink-0 cursor-auto">
          <div 
            class="w-4 h-4 border-2 border-t-transparent rounded-full animate-spin"
            [style.border-color]="'var(--ui-color-main) var(--ui-color-main) transparent var(--ui-color-main)'">
          </div>
        </div>
      }

      <span class="material-icons text-gray-400 transition-transform duration-200 pointer-events-none select-none"
        [class.rotate-180]="isOpen()"
        [style.color]="focused() ? 'var(--ui-color-main)' : ''"
      >
        expand_more
      </span>
    </div>

    @if (isOpen()) {
      <div class="absolute z-50 mt-1 w-full overflow-hidden rounded-lg border border-gray-200 bg-white shadow-xl animate-in fade-in zoom-in duration-100">
        
        @if (headerTmpl()) {
          <div class="border-b border-gray-100"><ng-container [ngTemplateOutlet]="headerTmpl()!.template"></ng-container></div>
        }

        <ul class="max-h-60 overflow-y-auto py-1">
          @for (option of options(); track $index) {
            <li (click)="selectOption(option)" class="group cursor-pointer px-3 py-2 text-sm transition-colors hover:bg-gray-50 active:bg-gray-100">
              @if (itemTmpl()) {
                <ng-container [ngTemplateOutlet]="itemTmpl()!.template" [ngTemplateOutletContext]="{ $implicit: option, index: $index }"></ng-container>
              } @else {
                <span class="text-gray-700 group-hover:text-black">{{ getLabel(option) }}</span>
              }
            </li>
          } @empty {
            <li class="px-3 py-4 text-center text-xs text-gray-400">{{  emptyMessage() }}</li>
          }
        </ul>

        @if (footerTmpl()) {
          <div class="border-t border-gray-100 bg-gray-50/50"><ng-container [ngTemplateOutlet]="footerTmpl()!.template"></ng-container></div>
        }
      </div>
    }
  </div>

  <div class="px-2 min-h-4 h-4 mt-0.5">
    @if (hasError()) {
      <span class="text-[12px] text-red-500 font-medium animate-in fade-in slide-in-from-top-1 block">
        {{ currentErrorMessage() }}
      </span>
    } @else if (hint()) {
      <span class="text-[12px] text-gray-500 block">{{ hint() }}</span>
    }
  </div>
</div>